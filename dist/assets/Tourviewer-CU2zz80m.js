import{u as R,a as A,r as l,j as e,L as M}from"./index-rPIBIrLb.js";const m=(...n)=>n.filter(Boolean).join(" ");function E(n){try{return new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(n)}catch{return`£${n}`}}function F(n){const a=new Date(n),s=a.getDate(),p=a.getFullYear(),f=a.getMonth();return`${s} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"][f]} ${p}`}function O(){const n=R(),{id:a}=A(),[s,p]=l.useState(null),[f,x]=l.useState(!0),[v,y]=l.useState(""),[u,b]=l.useState(0),[i,k]=l.useState([]),[j,S]=l.useState(""),[h,D]=l.useState(5),[N,B]=l.useState("");l.useEffect(()=>{a&&(x(!0),y(""),fetch(`http://localhost:3001/api/tours/${a}`).then(t=>{if(!t.ok)throw new Error("Tour not found");return t.json()}).then(t=>{var c,C;const r={id:((c=t.id)==null?void 0:c.toString())??"",title:t.title??"Untitled Tour",shortDescription:((C=t.description)==null?void 0:C.slice(0,80))??t.title??"",longDescription:t.description??t.title??"",durationDays:t.durationDays??1,location:t.location??"",nextStartDate:t.nextStartDate??"",availableSlots:t.availableSlots??0,priceGBP:Number(t.priceGBP)??0,images:Array.isArray(t.media)&&t.media.length>0?t.media.map(g=>g.url&&g.url.startsWith("/uploads/")?`http://localhost:3001${g.url}`:g.url):[],rating:4.8,difficulty:"Moderate"};p(r),x(!1)}).catch(t=>{y(t.message||"Failed to load tour"),x(!1)}))},[a]);const w=`tour_reviews_${a}`;l.useEffect(()=>{const t=localStorage.getItem(w);if(t)try{k(JSON.parse(t))}catch{}},[a]),l.useEffect(()=>{localStorage.setItem(w,JSON.stringify(i))},[i,w]);const L=l.useMemo(()=>!s||i.length===0?(s==null?void 0:s.rating)||0:i.reduce((t,r)=>t+r.rating,0)/i.length,[i,s]);function $(){if(!j.trim()||!N.trim())return;const t={id:Math.random().toString(36).slice(2),name:j.trim(),rating:h,message:N.trim(),createdISO:new Date().toISOString()};k(r=>[t,...r]),S(""),D(5),B("")}if(f)return e.jsx("div",{className:"text-center py-10",children:"Loading tour..."});if(v||!s)return e.jsx("div",{className:"text-center py-10 text-red-600",children:v||"Tour not found."});const o=s.images||[];function I(t){return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(t)}`}const d={Star:({className:t="h-4 w-4"})=>e.jsx("svg",{viewBox:"0 0 24 24",className:t,fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M12 17.27 18.18 21 16.54 13.97 22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"})}),Pin:({className:t="h-5 w-5"})=>e.jsxs("svg",{viewBox:"0 0 24 24",className:t,fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("path",{d:"M12 21s7-4.35 7-11a7 7 0 1 0-14 0c0 6.65 7 11 7 11z"}),e.jsx("circle",{cx:"12",cy:"10",r:"2.5"})]}),ArrowLeft:({className:t="h-5 w-5"})=>e.jsxs("svg",{viewBox:"0 0 24 24",className:t,fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("path",{d:"M19 12H5"}),e.jsx("path",{d:"m12 19-7-7 7-7"})]})};function P({src:t,alt:r,className:c}){return e.jsx("img",{src:t,alt:r,className:c,loading:"lazy"})}return e.jsxs("div",{className:"space-y-8 px-4 sm:px-6",children:[e.jsx("header",{className:"rounded-2xl bg-gradient-to-br from-emerald-600 via-emerald-500 to-emerald-700 p-6 text-white ring-1 ring-black/10",children:e.jsxs("div",{className:"mx-auto max-w-6xl",children:[e.jsxs("button",{onClick:()=>n(-1),className:"inline-flex items-center gap-2 rounded-xl bg-white/10 px-3 py-2 text-sm font-semibold ring-1 ring-white/30 transition hover:bg-white/20",children:[e.jsx(d.ArrowLeft,{})," Back"]}),e.jsx("h1",{className:"mt-3 text-3xl font-extrabold tracking-tight",children:s.title}),e.jsx("p",{className:"mt-1 max-w-3xl text-emerald-50",children:s.shortDescription})]})}),e.jsxs("div",{className:"mx-auto grid max-w-6xl gap-8 lg:grid-cols-3",children:[e.jsxs("section",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("article",{className:"overflow-hidden rounded-2xl bg-white ring-1 ring-black/5",children:[e.jsxs("div",{className:"relative h-60 w-full sm:h-80",children:[e.jsx(P,{src:o[u],alt:`${s.title} image ${u+1}`,className:"h-full w-full"}),o.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>b(t=>(t-1+o.length)%o.length),className:"absolute left-3 top-1/2 -translate-y-1/2 rounded-full bg-white/90 p-2 ring-1 ring-black/10 transition hover:scale-105","aria-label":"Previous image",children:e.jsx("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("button",{onClick:()=>b(t=>(t+1)%o.length),className:"absolute right-3 top-1/2 -translate-y-1/2 rounded-full bg-white/90 p-2 ring-1 ring-black/10 transition hover:scale-105","aria-label":"Next image",children:e.jsx("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 6l6 6-6 6"})})})]}),e.jsx("div",{className:"absolute bottom-3 left-1/2 flex -translate-x-1/2 gap-1",children:o.map((t,r)=>e.jsx("span",{className:m("h-1.5 w-4 rounded-full",r===u?"bg-white":"bg-white/50")},r))})]}),o.length>1&&e.jsx("div",{className:"grid grid-cols-4 gap-1 p-2 sm:p-3",children:o.slice(0,4).map((t,r)=>e.jsx("button",{onClick:()=>b(r),className:m("overflow-hidden rounded-xl ring-2 transition",u===r?"ring-emerald-500":"ring-transparent hover:ring-emerald-200"),children:e.jsx("img",{src:t,alt:`thumb ${r+1}`,className:"h-20 w-full object-cover sm:h-24"})},r))})]}),e.jsxs("article",{className:"rounded-2xl bg-white p-6 ring-1 ring-black/5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-xl font-extrabold text-neutral-900",children:s.title}),e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-100 px-3 py-1 text-sm font-semibold text-emerald-800",children:[e.jsx(d.Star,{className:"h-4 w-4"})," ",L.toFixed(1)]})]}),e.jsx("p",{className:"mt-1 text-neutral-700",children:s.shortDescription}),e.jsxs("dl",{className:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-xl bg-neutral-50 p-3",children:[e.jsx("dt",{className:"text-neutral-500",children:"Location"}),e.jsxs("dd",{className:"mt-0.5 flex items-center gap-2 font-semibold text-neutral-900",children:[s.location,e.jsxs("a",{href:I(s.location),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center rounded-full bg-emerald-600 px-2 py-1 text-xs font-semibold text-white hover:bg-emerald-700",title:"Open in Google Maps",children:[e.jsx(d.Pin,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1 hidden sm:inline",children:"Maps"})]})]})]}),e.jsxs("div",{className:"rounded-xl bg-neutral-50 p-3",children:[e.jsx("dt",{className:"text-neutral-500",children:"Duration"}),e.jsxs("dd",{className:"mt-0.5 font-semibold",children:[s.durationDays," days"]})]}),e.jsxs("div",{className:"rounded-xl bg-neutral-50 p-3",children:[e.jsx("dt",{className:"text-neutral-500",children:"Next start"}),e.jsx("dd",{className:"mt-0.5 font-semibold",children:F(s.nextStartDate)})]}),e.jsxs("div",{className:"rounded-xl bg-neutral-50 p-3",children:[e.jsx("dt",{className:"text-neutral-500",children:"Availability"}),e.jsx("dd",{className:m("mt-0.5 font-semibold",s.availableSlots>0?"text-emerald-700":"text-rose-700"),children:s.availableSlots>0?`${s.availableSlots} left`:"Sold out"})]})]}),e.jsxs("div",{className:"mt-5 flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-lg font-extrabold text-emerald-700",children:["from ",E(s.priceGBP)]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{to:"/tours",className:"inline-flex items-center rounded-2xl bg-white px-4 py-2 font-semibold text-emerald-700 ring-1 ring-emerald-300 transition hover:bg-emerald-50",children:"Back to tours"}),e.jsx(M,{to:`/booking?id=${encodeURIComponent(s.id)}`,state:{tour:s},className:"inline-flex items-center rounded-2xl bg-emerald-600 px-4 py-2 font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500",children:"Book now"})]})]})]})]}),e.jsx("aside",{className:"lg:col-span-1",children:e.jsxs("section",{className:"rounded-2xl bg-white p-6 ring-1 ring-black/5",children:[e.jsx("h3",{className:"text-lg font-extrabold text-neutral-900",children:"Reviews"}),e.jsxs("div",{className:"mt-3 rounded-xl bg-emerald-50 p-4 ring-1 ring-emerald-200",children:[e.jsx("label",{className:"block text-sm font-semibold text-neutral-700",children:"Name"}),e.jsx("input",{value:j,onChange:t=>S(t.target.value),placeholder:"Your name",className:"mt-1 w-full rounded-xl border border-emerald-300 bg-white/90 px-3 py-2 outline-none transition focus:border-emerald-500"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-neutral-700",children:"Rating"}),e.jsx("select",{value:h,onChange:t=>D(Number(t.target.value)),className:"mt-1 w-full rounded-xl border border-emerald-300 bg-white/90 px-3 py-2 outline-none transition focus:border-emerald-500",children:[5,4,3,2,1].map(t=>e.jsxs("option",{value:t,children:[t," ★"]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-neutral-700",children:"Preview"}),e.jsxs("div",{className:"mt-1 inline-flex items-center gap-1 rounded-xl bg-white px-3 py-2 ring-1 ring-emerald-200",children:[Array.from({length:5}).map((t,r)=>e.jsx(d.Star,{className:m("h-4 w-4",r<Math.round(h)?"text-emerald-600":"text-neutral-300")},r)),e.jsx("span",{className:"ml-1 text-sm font-semibold text-neutral-700",children:h.toFixed(1)})]})]})]}),e.jsx("label",{className:"mt-3 block text-sm font-semibold text-neutral-700",children:"Comment"}),e.jsx("textarea",{value:N,onChange:t=>B(t.target.value),placeholder:"How was your experience or what are you excited about?",rows:4,className:"mt-1 w-full rounded-xl border border-emerald-300 bg-white/90 px-3 py-2 outline-none transition focus:border-emerald-500"}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{onClick:$,className:"rounded-2xl bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-emerald-700",children:"Post review"})})]}),e.jsx("ul",{className:"mt-4 space-y-3",children:i.length===0?e.jsx("li",{className:"rounded-xl bg-neutral-50 p-4 text-sm text-neutral-700 ring-1 ring-neutral-200",children:"No reviews yet. Be the first to share your thoughts!"}):i.map(t=>e.jsxs("li",{className:"rounded-xl border border-emerald-200 bg-emerald-50/40 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-semibold text-neutral-900",children:t.name}),e.jsx("span",{className:"text-xs text-neutral-600",children:new Date(t.createdISO).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"mt-1 inline-flex items-center gap-1",children:[Array.from({length:5}).map((r,c)=>e.jsx(d.Star,{className:m("h-3.5 w-3.5",c<t.rating?"text-emerald-600":"text-neutral-300")},c)),e.jsx("span",{className:"ml-1 text-xs font-semibold text-neutral-700",children:t.rating.toFixed(1)})]}),e.jsx("p",{className:"mt-2 text-sm text-neutral-800",children:t.message})]},t.id))})]})})]})]})}export{O as default};
