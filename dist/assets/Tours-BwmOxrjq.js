import{u as A,a as E,r as i,j as e,b as T,c as I}from"./index-rPIBIrLb.js";import{A as P}from"./AuthPromptModal-CtVEw2cU.js";const v={Hiking:()=>e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"h-5 w-5",children:e.jsx("path",{d:"M12 2v2m0 0a4 4 0 0 1 4 4v2a4 4 0 0 1-4 4m0-10a4 4 0 0 0-4 4v2a4 4 0 0 0 4 4m0 0v6m0 0h4m-4 0H8"})}),Cycling:()=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"h-5 w-5",children:[e.jsx("circle",{cx:"5.5",cy:"18.5",r:"3.5"}),e.jsx("circle",{cx:"18.5",cy:"18.5",r:"3.5"}),e.jsx("path",{d:"M15 18.5V15a3 3 0 0 0-3-3H8.5"}),e.jsx("path",{d:"M8.5 18.5V15"}),e.jsx("path",{d:"M12 12l-2.5 3.5"})]}),Nature:()=>e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"h-5 w-5",children:e.jsx("path",{d:"M12 2v20m0 0c-4.418 0-8-3.582-8-8 0-2.21.895-4.21 2.343-5.657M12 22c4.418 0 8-3.582 8-8 0-2.21-.895-4.21-2.343-5.657"})}),Star:()=>e.jsx("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-4 text-yellow-400",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.967a1 1 0 0 0 .95.69h4.178c.969 0 1.371 1.24.588 1.81l-3.385 2.46a1 1 0 0 0-.364 1.118l1.287 3.966c.3.922-.755 1.688-1.54 1.118l-3.385-2.46a1 1 0 0 0-1.176 0l-3.385 2.46c-.784.57-1.838-.196-1.539-1.118l1.287-3.966a1 1 0 0 0-.364-1.118l-3.385-2.46c-.783-.57-.38-1.81.588-1.81h4.178a1 1 0 0 0 .95-.69l1.286-3.967z"})})},M="https://placehold.co/600x400/defef0/cccccc?text=No+Image";function G(s){if(!s)return"-";try{return new Date(s).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"})}catch{return s}}function y(...s){return s.filter(Boolean).join(" ")}function $(s){try{return new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(s)}catch{return`£${s}`}}function H({src:s,alt:r,className:n,imgClass:o,width:g,height:d}){const[w,m]=i.useState(!1),[p,f]=i.useState(!1),x=p||!s?M:s;return e.jsxs("div",{className:y("relative overflow-hidden bg-emerald-50",n),children:[e.jsx("img",{src:x,alt:r,loading:"lazy",decoding:"async",width:g,height:d,srcSet:s?`${s}&w=420 420w, ${s}&w=640 640w, ${s}&w=860 860w`:void 0,sizes:"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 320px",onLoad:()=>m(!0),onError:()=>f(!0),className:y("h-full w-full object-cover transition-opacity duration-500 ease-out",w?"opacity-100":"opacity-0",o)}),e.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute inset-0 bg-gradient-to-t from-black/25 via-black/0"})]})}function F(){const{hash:s}=T();return i.useMemo(()=>{const r=(s||"").replace("#","").toLowerCase();return["hiking","cycling","nature"].includes(r)?r:"all"},[s])}function W(){const[s]=I();return s.get("focus")||""}function U(){const s=A(),{slug:r}=E(),n=F(),[o,g]=i.useState(n),[d,w]=i.useState(""),m=W(),p=i.useRef(null),[f,x]=i.useState({open:!1}),[D,b]=i.useState([]),[B,L]=i.useState([{slug:"hiking",name:"Hiking"},{slug:"cycling",name:"Cycling"},{slug:"nature",name:"Nature walks"}]),[j,N]=i.useState([]);i.useEffect(()=>{fetch("/data/tours.json").then(t=>t.json()).then(t=>{if(Array.isArray(t==null?void 0:t.categories)){const a=t.categories.map(l=>({slug:l.slug,name:String(l.name||l.slug)})).filter(l=>["hiking","cycling","nature"].includes(l.slug));a.length&&L(a)}const c=(Array.isArray(t==null?void 0:t.tours)?t.tours:[]).map(a=>{var l,h;return{id:((l=a.id)==null?void 0:l.toString())??"",title:a.title??"Untitled Tour",category:a.category||"hiking",shortDescription:((h=a.description)==null?void 0:h.slice(0,80))??a.title??"",longDescription:a.description??a.title??"",durationDays:a.durationDays??1,location:a.location??"",nextStartDate:a.nextStartDate??"",availableSlots:a.availableSlots??0,priceGBP:Number(a.priceGBP)??0,images:Array.isArray(a.media)&&a.media.length>0?a.media.map(u=>u.url):[],rating:4.8,difficulty:"Moderate"}});b(c)}).catch(()=>b([])),fetch("http://localhost:3001/api/tours").then(t=>t.json()).then(t=>{const c=t.map(a=>{var l,h;return{id:((l=a.id)==null?void 0:l.toString())??"",title:a.title??"Untitled Tour",category:"hiking",shortDescription:((h=a.description)==null?void 0:h.slice(0,80))??a.title??"",longDescription:a.description??a.title??"",durationDays:a.durationDays??1,location:a.location??"",nextStartDate:a.nextStartDate??"",availableSlots:a.availableSlots??0,priceGBP:Number(a.priceGBP)??0,images:Array.isArray(a.media)&&a.media.length>0?a.media.map(u=>u.url&&u.url.startsWith("/uploads/")?`http://localhost:3001${u.url}`:u.url):[],rating:4.8,difficulty:"Moderate"}});N(c)}).catch(()=>N([]))},[]),i.useEffect(()=>{const t=c=>{var l;x({open:!0,pendingId:(l=c.detail)==null?void 0:l.id})};return window.addEventListener("open-auth-prompt",t),()=>window.removeEventListener("open-auth-prompt",t)},[]),i.useEffect(()=>{const t=r&&["hiking","cycling","nature"].includes(r)?r:void 0;g(t||n)},[r,n]),i.useEffect(()=>{m&&setTimeout(()=>{var t;return(t=p.current)==null?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})},80)},[m]);const k=j.length?j:D,S=i.useMemo(()=>k.filter(t=>o==="all"?!0:t.category===o).filter(t=>{if(!d.trim())return!0;const c=d.toLowerCase();return t.title.toLowerCase().includes(c)||t.location.toLowerCase().includes(c)||(t.shortDescription?t.shortDescription.toLowerCase().includes(c):!1)}),[k,o,d]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(P,{open:f.open,onClose:()=>x({open:!1}),onContinue:()=>{const t=f.pendingId;x({open:!1,pendingId:void 0}),t&&s(`/tour/${t}`)}}),e.jsxs("header",{className:"rounded-2xl bg-gradient-to-br from-emerald-600 via-emerald-500 to-emerald-700 px-4 py-4 text-white ring-1 ring-black/10",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-extrabold tracking-tight",children:"Tours & Itineraries"}),e.jsx("p",{className:"mt-1 text-sm sm:text-base text-emerald-100",children:"Explore eco-friendly hiking trips, cycling tours, and guided nature walks across the UK."})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("nav",{className:"flex flex-wrap gap-2",children:[e.jsx(C,{label:"All",active:o==="all",onClick:()=>s("/tours")}),B.map(t=>e.jsx(C,{icon:t.slug==="hiking"?e.jsx(v.Hiking,{}):t.slug==="cycling"?e.jsx(v.Cycling,{}):e.jsx(v.Nature,{}),label:t.name,active:o===t.slug,onClick:()=>s(`/tours/category/${t.slug}`)},t.slug))]}),e.jsxs("div",{className:"relative w-full sm:w-72",children:[e.jsx("input",{value:d,onChange:t=>w(t.target.value),placeholder:"Search tours, e.g. 'Cotswolds'…",className:"w-full rounded-xl border border-emerald-300 bg-white/90 px-9 py-2.5 text-neutral-900 placeholder-neutral-500 outline-none transition focus:border-emerald-500"}),e.jsx("span",{className:"pointer-events-none absolute left-2.5 top-2.5 inline-flex h-6 w-6 items-center justify-center text-emerald-600",children:e.jsxs("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",fill:"none",stroke:"currentColor",strokeWidth:"1.8",children:[e.jsx("circle",{cx:"11",cy:"11",r:"7"}),e.jsx("path",{d:"m20 20-3.5-3.5"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[S.length===0&&e.jsx("div",{className:"col-span-full rounded-2xl bg-white p-6 text-center text-neutral-700 ring-1 ring-black/5",children:"No tours match your filters. Try clearing search or switching categories."}),S.map(t=>e.jsx("div",{ref:t.id===m?p:void 0,children:e.jsx(z,{tour:t,navigate:s})},t.id))]})]})}function C({label:s,icon:r,active:n,onClick:o}){return e.jsxs("button",{onClick:o,className:y("inline-flex items-center gap-2 rounded-xl px-3 py-1.5 text-sm font-semibold ring-1 transition",n?"bg-emerald-600 text-white ring-emerald-600":"bg-white text-emerald-700 ring-emerald-300 hover:bg-emerald-50"),children:[r&&e.jsx("span",{className:"text-white/90",children:n?r:e.jsx("span",{className:"text-emerald-700",children:r})}),s]})}function z({tour:s,navigate:r}){const n=s.availableSlots<=0,o=typeof s.rating=="number"&&!isNaN(s.rating)?s.rating.toFixed(1):"-";return e.jsxs("article",{className:"group flex h-full flex-col overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-black/5 transition hover:-translate-y-0.5 hover:shadow-lg",children:[e.jsxs("div",{className:"relative w-full h-36 sm:h-40 overflow-hidden",children:[e.jsx(H,{src:s.images[0],alt:s.title,className:"h-full w-full",width:640,height:360}),e.jsxs("div",{className:"absolute left-2.5 top-2.5 inline-flex items-center gap-2 rounded-full bg-emerald-100 px-2.5 py-1 text-[11px] font-semibold text-emerald-800 ring-1 ring-emerald-600/20",children:[e.jsx("span",{className:"inline-block size-2 rounded-full bg-emerald-600"}),s.category]})]}),e.jsxs("div",{className:"flex flex-1 flex-col p-3",children:[e.jsx("h3",{className:"text-sm sm:text-base font-bold text-neutral-900 line-clamp-1",children:s.title}),e.jsxs("p",{className:"mt-1 text-xs text-neutral-700 line-clamp-1",children:[s.location," • ",s.durationDays," days"]}),e.jsxs("p",{className:"mt-0.5 text-[11px] text-neutral-500",children:["Next start ",G(s.nextStartDate)]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("span",{className:y("text-xs sm:text-sm font-semibold",n?"text-rose-700":s.availableSlots<=5?"text-amber-700":"text-emerald-700"),children:n?"Sold out":`${s.availableSlots} left`}),e.jsx("span",{className:"text-sm font-extrabold text-emerald-700",children:$(Number(s.priceGBP)||0)})]}),e.jsx("div",{className:"mt-2 flex items-center justify-between",children:e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-100 px-2 py-0.5 text-[11px] sm:text-xs font-semibold text-emerald-800",children:[e.jsx(v.Star,{})," ",o]})}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"w-full inline-flex items-center justify-center rounded-xl px-3 py-2 text-sm font-semibold bg-indigo-600 text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",onClick:()=>{if(!!!localStorage.getItem("user")){try{const d=new CustomEvent("open-auth-prompt",{detail:{id:s.id}});window.dispatchEvent(d)}catch{}return}r(`/tour/${s.id}`)},children:"View"})})]})]})}export{U as default};
