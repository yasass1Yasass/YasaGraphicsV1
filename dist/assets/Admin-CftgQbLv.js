import{r as a,j as e,u as A,L as y}from"./index-rPIBIrLb.js";const S=(s="id")=>`${s}_${Math.random().toString(36).slice(2,9)}${Date.now()}`;function f(s,n){try{const h=localStorage.getItem(s);return h?JSON.parse(h):n}catch{return n}}function C(s,n){localStorage.setItem(s,JSON.stringify(n))}function T(s){try{return new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(s)}catch{return`£${s}`}}function v({title:s,subtitle:n}){return e.jsxs("header",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-extrabold bg-gradient-to-r from-emerald-700 via-emerald-600 to-indigo-600 bg-clip-text text-transparent",children:s}),n&&e.jsx("p",{className:"mt-1 text-neutral-600",children:n})]})}function I({children:s}){return e.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-100 px-2.5 py-1 text-xs font-semibold text-emerald-800 ring-1 ring-emerald-600/20",children:s})}function B(){const[s,n]=a.useState({tours:0,rentals:0,users:0});return a.useEffect(()=>{const h=f("custom_tours",[]).length,m=f("rental_items",[]).length,u=f("admin_users",M()).length;n({tours:h,rentals:m,users:u})},[]),e.jsxs("div",{className:"space-y-8 px-4 sm:px-6",children:[e.jsx("section",{className:"rounded-2xl bg-gradient-to-br from-emerald-600 via-emerald-500 to-indigo-600 p-6 text-white ring-1 ring-black/10",children:e.jsxs("div",{className:"mx-auto max-w-7xl",children:[e.jsx("h1",{className:"text-3xl font-extrabold tracking-tight",children:"Admin Dashboard"}),e.jsx("p",{className:"mt-1 text-emerald-50",children:"Quick actions on the left. Manage users in the main panel."}),e.jsxs("dl",{className:"mt-4 grid max-w-md grid-cols-3 gap-3",children:[e.jsxs("div",{className:"rounded-xl bg-white/10 px-3 py-3 text-center ring-1 ring-white/20",children:[e.jsx("dt",{className:"text-xs text-emerald-50",children:"Tours"}),e.jsx("dd",{className:"text-lg font-extrabold",children:s.tours})]}),e.jsxs("div",{className:"rounded-xl bg-white/10 px-3 py-3 text-center ring-1 ring-white/20",children:[e.jsx("dt",{className:"text-xs text-emerald-50",children:"Rentals"}),e.jsx("dd",{className:"text-lg font-extrabold",children:s.rentals})]}),e.jsxs("div",{className:"rounded-xl bg-white/10 px-3 py-3 text-center ring-1 ring-white/20",children:[e.jsx("dt",{className:"text-xs text-emerald-50",children:"Users"}),e.jsx("dd",{className:"text-lg font-extrabold",children:s.users})]})]})]})}),e.jsxs("div",{className:"mx-auto grid max-w-7xl gap-8 lg:grid-cols-12",children:[e.jsxs("aside",{className:"space-y-6 lg:col-span-3",children:[e.jsx(L,{}),e.jsx($,{})]}),e.jsxs("main",{className:"space-y-8 lg:col-span-9",children:[e.jsx(P,{}),e.jsx(O,{}),e.jsx(_,{})]})]})]})}function L(){const s=A();function n(){try{localStorage.removeItem("admin_auth")}catch{}alert("Logged out (demo). Redirecting to login."),s("/login")}return e.jsxs("section",{className:"rounded-2xl bg-white p-6 ring-1 ring-black/5",children:[e.jsx(v,{title:"Quick actions"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("button",{onClick:n,className:"inline-flex items-center justify-center gap-2 rounded-xl bg-rose-600 px-4 py-2 font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-rose-700",children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",className:"opacity-90",children:[e.jsx("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",stroke:"currentColor",strokeWidth:"1.8"}),e.jsx("path",{d:"M10 17l5-5-5-5",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M15 12H3",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"})]}),"Log out"]}),e.jsxs(y,{to:"/admin/create/tour",className:"inline-flex items-center justify-center gap-2 rounded-xl bg-emerald-600 px-4 py-2 font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-emerald-700",title:"Go to the tour composer page",children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",className:"opacity-90",fill:"none",children:e.jsx("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"})}),"Post Tour"]}),e.jsxs(y,{to:"/admin/create/rental",className:"inline-flex items-center justify-center gap-2 rounded-xl bg-indigo-600 px-4 py-2 font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-indigo-700",title:"Go to the rental composer page",children:[e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",className:"opacity-90",fill:"none",children:e.jsx("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"})}),"Post Rental"]}),e.jsx(y,{to:"/tours",className:"inline-flex items-center justify-center rounded-xl bg-white px-4 py-2 font-semibold text-emerald-700 ring-1 ring-emerald-300 transition hover:bg-emerald-50",children:"View site → Tours"}),e.jsx(y,{to:"/rentals",className:"inline-flex items-center justify-center rounded-xl bg-white px-4 py-2 font-semibold text-indigo-700 ring-1 ring-indigo-300 transition hover:bg-indigo-50",children:"View site → Rentals"})]})]})}function $(){return e.jsx("section",{className:"rounded-2xl bg-gradient-to-br from-emerald-50 via-white to-indigo-50 p-5 ring-1 ring-emerald-200",children:e.jsxs("p",{className:"text-sm text-neutral-700",children:[e.jsx("strong",{children:"Heads up:"})," This demo uses ",e.jsx("code",{children:"localStorage"}),". The “Post Tour” and “Post Rental” links assume you’ll add composer pages later."]})})}function M(){return[{id:S("usr"),name:"Alex Morgan",email:"alex@example.com",role:"admin",status:"active",lastSeenISO:new Date(Date.now()-60*60*1e3).toISOString()},{id:S("usr"),name:"Samir Patel",email:"samir@example.com",role:"editor",status:"active",lastSeenISO:new Date(Date.now()-5*60*60*1e3).toISOString()},{id:S("usr"),name:"Maya Chen",email:"maya@example.com",role:"viewer",status:"suspended",lastSeenISO:new Date(Date.now()-24*60*60*1e3).toISOString()}]}function P(){const[s,n]=a.useState([]),[h,m]=a.useState(!1),[u,i]=a.useState(""),[d,x]=a.useState(null),[g,p]=a.useState(null),c=f("admin_auth",{name:"Demo Admin",email:"admin@example.com",role:"admin"}).role==="admin",j=()=>{m(!0),i(""),fetch("http://localhost:3001/api/users").then(async r=>{if(!r.ok){let o="Failed to fetch users.";try{const t=await r.json();o=(t==null?void 0:t.error)||o}catch{}throw new Error(o)}return r.json()}).then(r=>n(Array.isArray(r)?r:[])).catch(r=>{const o=r instanceof Error?r.message:"Failed to fetch users.";i(o),p({type:"error",text:o})}).finally(()=>m(!1))};a.useEffect(()=>{j()},[]);const N=a.useMemo(()=>[...s].sort((r,o)=>r.name.localeCompare(o.name)),[s]);function b(r){if(!c)return alert("Only admins can delete users.");window.confirm(`Delete ${r.name}?`)&&(x(r.id),fetch(`http://localhost:3001/api/users/${r.id}`,{method:"DELETE"}).then(async o=>{if(!o.ok){let t=`Delete failed for ${r.name}`;try{const l=await o.json();t=(l==null?void 0:l.error)||t}catch{}throw new Error(t)}n(t=>t.filter(l=>l.id!==r.id)),p({type:"success",text:`Deleted ${r.name}`})}).catch(o=>{const t=o instanceof Error?o.message:"Failed to delete user.";p({type:"error",text:t})}).finally(()=>x(null)))}function k(){alert("User invite not implemented. Use signup form to add users.")}return e.jsxs("section",{className:"rounded-2xl bg-white p-6 ring-1 ring-black/5",children:[e.jsx(v,{title:"User management",subtitle:"Only admins can modify or delete users."}),g&&e.jsxs("div",{className:`mb-3 rounded-xl px-4 py-3 text-sm ring-1 ${g.type==="error"?"bg-rose-50 text-rose-700 ring-rose-200":"bg-emerald-50 text-emerald-800 ring-emerald-200"}`,role:g.type==="error"?"alert":"status",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("p",{className:"font-semibold",children:g.type==="error"?"Error":"Success"}),e.jsx("button",{onClick:()=>p(null),className:"text-xs font-semibold opacity-70 hover:opacity-100","aria-label":"Dismiss",children:"Dismiss"})]}),e.jsx("p",{className:"mt-1",children:g.text})]}),e.jsxs("div",{className:"mt-0 flex flex-wrap gap-2",children:[e.jsx("button",{onClick:k,className:"rounded-xl bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-emerald-700",disabled:!c,title:c?"Invite a new user":"Admin only",children:"Invite user"}),e.jsx(y,{to:"/settings",className:"rounded-xl bg-white px-4 py-2 text-sm font-semibold text-emerald-700 ring-1 ring-emerald-300 transition hover:bg-emerald-50",children:"Admin settings"})]}),e.jsx("div",{className:"mt-4 overflow-hidden rounded-xl ring-1 ring-emerald-200",children:h?e.jsx("div",{className:"px-4 py-6 text-emerald-700",children:"Loading users"}):u?e.jsx("div",{className:"px-4 py-6 text-rose-700",children:u}):e.jsxs("table",{className:"min-w-full divide-y divide-emerald-100",children:[e.jsx("thead",{className:"bg-emerald-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-neutral-700",children:"User"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-neutral-700",children:"Email"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-semibold text-neutral-700",children:"Delete"})]})}),e.jsx("tbody",{className:"divide-y divide-emerald-100 bg-white",children:N.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"px-4 py-6 text-center text-sm text-neutral-600",children:"No users yet."})}):N.map(r=>e.jsxs("tr",{className:"hover:bg-emerald-50/40",children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-neutral-900",children:r.name}),e.jsx("td",{className:"px-4 py-3 text-xs text-neutral-600",children:r.email}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>b(r),className:"rounded-lg bg-rose-600 px-3 py-1.5 text-xs font-semibold text-white hover:bg-rose-700 disabled:opacity-50",disabled:!c||d===r.id,title:c?"Delete user":"Admin only",children:d===r.id?"Deleting…":"Delete"})})})]},r.id))})]})})]})}function O(){const[s,n]=a.useState([]),[h,m]=a.useState(!1),[u,i]=a.useState(""),[d,x]=a.useState(null),p=f("admin_auth",{name:"Demo Admin",email:"admin@example.com",role:"admin"}).role==="admin",D=()=>{m(!0),i(""),fetch("http://localhost:3001/api/tours").then(t=>t.json()).then(t=>n(t)).catch(()=>i("Failed to fetch tours.")).finally(()=>m(!1))};a.useEffect(()=>{D()},[]);const[c,j]=a.useState(null),[N,b]=a.useState("");function k(t,l){if(!p)return alert("Only admins can delete tours.");j(t),b(l)}function r(){if(!c)return;x(c);const t=c.toString();fetch(`http://localhost:3001/api/tours/${encodeURIComponent(t)}`,{method:"DELETE"}).then(l=>{if(!l.ok)throw new Error(`Delete failed for id ${t}`);n(w=>w.filter(E=>E.id.toString()!==t)),j(null),b("")}).catch(l=>{alert(`Failed to delete tour (id: ${t}): ${l}`),j(null),b("")}).finally(()=>x(null))}function o(){j(null),b("")}return e.jsxs("section",{className:"rounded-2xl bg-white p-6 ring-1 ring-black/5",children:[e.jsx(v,{title:"Posted tours",subtitle:"Items pulled from backend API"}),h?e.jsx("p",{className:"text-emerald-700",children:"Loading tours…"}):u?e.jsx("p",{className:"text-rose-700",children:u}):s.length===0?e.jsx("p",{className:"text-sm text-neutral-600",children:"No posted tours yet."}):e.jsx("ul",{className:"space-y-3",children:s.map(t=>e.jsxs("li",{className:"flex items-center gap-3 rounded-xl border border-emerald-200 bg-emerald-50/50 p-3",children:[e.jsx("img",{src:(()=>{var w;const l=t.media;return Array.isArray(l)&&l.length>0&&l[0].url?l[0].url.startsWith("/uploads/")?`http://localhost:3001${l[0].url}`:l[0].url:((w=t.images)==null?void 0:w[0])||""})(),alt:t.title,onError:l=>l.currentTarget.src="data:image/svg+xml;base64,"+btoa("<svg xmlns='http://www.w3.org/2000/svg' width='80' height='80'><rect width='100%' height='100%' fill='#e5f5ec'/></svg>"),className:"h-12 w-12 rounded-lg object-cover ring-1 ring-emerald-200"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate font-semibold text-neutral-900",children:t.title}),e.jsxs("p",{className:"truncate text-xs text-neutral-600",children:[t.location," • ",e.jsx(I,{children:t.category||"-"})," • ",t.durationDays||1,"d • ",T(Number(t.priceGBP)||0)]})]}),e.jsx("button",{onClick:()=>k(t.id,t.title),className:"ml-auto rounded-xl bg-rose-600 px-3 py-1.5 text-sm font-semibold text-white hover:bg-rose-700 disabled:opacity-50",disabled:!p||d===t.id,title:p?"Delete tour":"Admin only",children:d===t.id?"Deleting…":"Delete"})]},t.id))}),c&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:e.jsxs("div",{className:"rounded-2xl bg-white p-6 shadow-xl w-full max-w-xs",children:[e.jsx("h3",{className:"text-lg font-bold mb-2 text-rose-700",children:"Delete Tour"}),e.jsxs("p",{className:"mb-4 text-neutral-700",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-semibold",children:N}),"?"]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:o,className:"rounded-xl bg-neutral-200 px-4 py-2 font-semibold text-neutral-700 hover:bg-neutral-300",disabled:d===c,children:"Cancel"}),e.jsx("button",{onClick:r,className:"rounded-xl bg-rose-600 px-4 py-2 font-semibold text-white hover:bg-rose-700 disabled:opacity-50",disabled:d===c,children:d===c?"Deleting…":"Delete"})]})]})})]})}function _(){const[s,n]=a.useState([]),m=f("admin_auth",{name:"Demo Admin",email:"admin@example.com",role:"admin"}).role==="admin";a.useEffect(()=>n(f("rental_items",[])),[]);function u(i,d){if(!m)return alert("Only admins can delete rentals.");if(!confirm(`Delete rental: ${d}?`))return;const x=s.filter(g=>g.id!==i);n(x),C("rental_items",x)}return e.jsxs("section",{className:"rounded-2xl bg-white p-6 ring-1 ring-black/5",children:[e.jsx(v,{title:"Rent posts",subtitle:"Items pulled from localStorage.rental_items"}),s.length===0?e.jsx("p",{className:"text-sm text-neutral-600",children:"No rent posts yet."}):e.jsx("ul",{className:"space-y-3",children:s.map(i=>{var d;return e.jsxs("li",{className:"flex items-center gap-3 rounded-xl border border-emerald-200 bg-emerald-50/50 p-3",children:[e.jsx("img",{src:(d=i.images)==null?void 0:d[0],alt:i.title,onError:x=>x.currentTarget.src="data:image/svg+xml;base64,"+btoa("<svg xmlns='http://www.w3.org/2000/svg' width='80' height='80'><rect width='100%' height='100%' fill='#eef2ff'/></svg>"),className:"h-12 w-12 rounded-lg object-cover ring-1 ring-emerald-200"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate font-semibold text-neutral-900",children:i.title}),e.jsxs("p",{className:"truncate text-xs text-neutral-600",children:[e.jsx(I,{children:i.category})," • £",Math.round(i.dailyGBP),"/day • stock ",i.stock]})]}),e.jsx("button",{onClick:()=>u(i.id,i.title),className:"ml-auto rounded-xl bg-rose-600 px-3 py-1.5 text-sm font-semibold text-white hover:bg-rose-700 disabled:opacity-50",disabled:!m,title:m?"Delete rental":"Admin only",children:"Delete"})]},i.id)})})]})}export{B as default};
